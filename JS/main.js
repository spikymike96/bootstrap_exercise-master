//JSON
var data = [{
    "id": 1,
    "city": "Manchester",
    "venue": null,
    "date": "04/05/2017",
    "startTime": "21:13",
    "numberofslots": 5,
    "bands": [
        { "id": 1, "name": "Bruno Mars" },
        { "id": 2, "name": "Coldplay" },
        { "id": 3, "name": "Linkin Park" }
    ]
}, {
    "id": 2,
    "city": "Manchester",
    "venue": null,
    "date": "30/04/2017",
    "startTime": "23:06",
    "band1": "pellentesque viverra pede ac",
    "band2": "venenatis tristique fusce congue",
    "band3": null,
    "band4": null
}, {
    "id": 3,
    "city": "Manchester",
    "venue": null,
    "date": "18/05/2017",
    "startTime": "21:51",
    "band1": "in magna bibendum imperdiet",
    "band2": "justo",
    "band3": "fusce lacus purus",
    "band4": null
}, {
    "id": 4,
    "city": "York",
    "venue": null,
    "date": "08/05/2017",
    "startTime": "22:27",
    "band1": "ultrices aliquet maecenas",
    "band2": "pellentesque",
    "band3": null,
    "band4": null
}, {
    "id": 5,
    "city": "York",
    "venue": null,
    "date": "07/05/2017",
    "startTime": "23:39",
    "band1": "non pretium quis lectus",
    "band2": "quis tortor",
    "band3": null,
    "band4": null
}, {
    "id": 6,
    "city": "York",
    "venue": null,
    "date": "26/05/2017",
    "startTime": "23:53",
    "band1": "lorem",
    "band2": "orci luctus et ultrices",
    "band3": "posuere cubilia curae",
    "band4": null
}, {
    "id": 7,
    "city": "Leeds",
    "venue": null,
    "date": "27/04/2017",
    "startTime": "21:48",
    "band1": "aliquam non",
    "band2": "auctor gravida sem",
    "band3": "aenean fermentum donec ut",
    "band4": null
}, {
    "id": 8,
    "city": "Leeds",
    "venue": null,
    "date": "26/04/2017",
    "startTime": "20:12",
    "band1": "mattis egestas metus aenean",
    "band2": "adipiscing elit proin",
    "band3": null,
    "band4": null
}, {
    "id": 9,
    "city": "Leeds",
    "venue": null,
    "date": "26/04/2017",
    "startTime": "21:29",
    "band1": "nam congue risus",
    "band2": "non velit",
    "band3": null,
    "band4": null
}, {
    "id": 10,
    "city": "Manchester",
    "venue": null,
    "date": "27/04/2017",
    "startTime": "18:06",
    "band1": "nisl",
    "band2": "id turpis",
    "band3": null,
    "band4": null
}, {
    "id": 11,
    "city": "Manchester",
    "venue": null,
    "date": "23/05/2017",
    "startTime": "22:23",
    "band1": "auctor sed tristique",
    "band2": "vestibulum ac",
    "band3": "ante ipsum",
    "band4": null
}, {
    "id": 12,
    "city": "Manchester",
    "venue": null,
    "date": "06/05/2017",
    "startTime": "22:30",
    "band1": "maecenas rhoncus",
    "band2": "non mattis pulvinar",
    "band3": "vel est donec odio",
    "band4": null
}, {
    "id": 13,
    "city": "York",
    "venue": null,
    "date": "06/05/2017",
    "startTime": "19:07",
    "band1": "arcu",
    "band2": "amet eleifend",
    "band3": null,
    "band4": null
}, {
    "id": 14,
    "city": "York",
    "venue": null,
    "date": "25/04/2017",
    "startTime": "22:53",
    "band1": "luctus et ultrices",
    "band2": "libero convallis eget",
    "band3": "justo in hac habitasse",
    "band4": null
}, {
    "id": 15,
    "city": "York",
    "venue": null,
    "date": "18/05/2017",
    "startTime": "21:59",
    "band1": "ipsum dolor sit amet",
    "band2": "velit id pretium iaculis",
    "band3": null,
    "band4": null
}, {
    "id": 16,
    "city": "Manchester",
    "venue": null,
    "date": "04/05/2017",
    "startTime": "18:08",
    "band1": "sit amet",
    "band2": "tortor id nulla",
    "band3": "quis orci nullam",
    "band4": null
}, {
    "id": 17,
    "city": "Manchester",
    "venue": null,
    "date": "19/05/2017",
    "startTime": "21:17",
    "band1": "diam erat",
    "band2": "luctus cum",
    "band3": "nulla sed vel",
    "band4": null
}, {
    "id": 18,
    "city": "Manchester",
    "venue": null,
    "date": "04/05/2017",
    "startTime": "22:29",
    "band1": "ac diam",
    "band2": "justo maecenas rhoncus",
    "band3": "in hac habitasse platea",
    "band4": null
}, {
    "id": 19,
    "city": "Leeds",
    "venue": null,
    "date": "20/05/2017",
    "startTime": "18:13",
    "band1": "in quam",
    "band2": "molestie hendrerit",
    "band3": "id lobortis convallis tortor",
    "band4": null
}, {
    "id": 20,
    "city": "Leeds",
    "venue": null,
    "date": "19/05/2017",
    "startTime": "20:38",
    "band1": "dapibus nulla suscipit",
    "band2": "tellus semper interdum mauris",
    "band3": null,
    "band4": null
}, {
    "id": 21,
    "city": "Leeds",
    "venue": null,
    "date": "09/05/2017",
    "startTime": "20:27",
    "band1": "sapien placerat",
    "band2": "posuere cubilia curae mauris",
    "band3": "lorem integer tincidunt ante",
    "band4": null
}, {
    "id": 22,
    "city": "York",
    "venue": null,
    "date": "19/05/2017",
    "startTime": "19:45",
    "band1": "rhoncus",
    "band2": "odio cras mi pede",
    "band3": "blandit lacinia erat vestibulum",
    "band4": null
}, {
    "id": 23,
    "city": "York",
    "venue": null,
    "date": "27/04/2017",
    "startTime": "21:30",
    "band1": "in libero ut massa",
    "band2": "lacinia sapien quis",
    "band3": "in tempor turpis",
    "band4": null
}, {
    "id": 24,
    "city": "York",
    "venue": null,
    "date": "27/05/2017",
    "startTime": "21:23",
    "band1": "feugiat non",
    "band2": "amet sapien",
    "band3": "in tempus sit",
    "band4": null
}, {
    "id": 25,
    "city": "York",
    "venue": null,
    "date": "07/05/2017",
    "startTime": "18:48",
    "band1": "urna ut",
    "band2": "eu orci",
    "band3": "lectus suspendisse",
    "band4": null
}, {
    "id": 26,
    "city": "York",
    "venue": null,
    "date": "09/05/2017",
    "startTime": "23:32",
    "band1": "viverra pede",
    "band2": "odio porttitor id consequat",
    "band3": "congue etiam justo etiam",
    "band4": null
}, {
    "id": 27,
    "city": "York",
    "venue": null,
    "date": "15/05/2017",
    "startTime": "18:48",
    "band1": "scelerisque quam",
    "band2": "nulla",
    "band3": null,
    "band4": null
}, {
    "id": 28,
    "city": "Manchester",
    "venue": null,
    "date": "03/05/2017",
    "startTime": "22:06",
    "band1": "cras in purus",
    "band2": "platea dictumst",
    "band3": null,
    "band4": null
}, {
    "id": 29,
    "city": "Manchester",
    "venue": null,
    "date": "25/04/2017",
    "startTime": "22:02",
    "band1": "pulvinar sed",
    "band2": "sit amet cursus",
    "band3": "erat",
    "band4": null
}, {
    "id": 30,
    "city": "Manchester",
    "venue": null,
    "date": "28/04/2017",
    "startTime": "19:09",
    "band1": "felis sed",
    "band2": "convallis nulla neque libero",
    "band3": "convallis duis",
    "band4": null
}];


var cities = []; //an array for the selected cities to be stored in

function isInArray(value, array) { //checks if element is in array
    return array.indexOf(value) > -1;
}

function doalert(city) { //when checkbox is checked
    if (!isInArray(city, cities)) { //if city not in array, add it to the cities array
        cities.push(city);
    } else { //if it is, check where in the array it is and get rid of it
        var index = cities.indexOf(city);
        cities.splice(index, 1);
    }
    console.log(cities);
}

function submit() {
    var startDate = moment(from.value, "YYYY-MM-DD");
    var endDate = moment(until.value, "YYYY-MM-DD");

    var filtered = data.filter(function(item) { //item is one of the values of 'data' e.g data[0]
        var date = moment(item.date, "DD/MM/YYYY"); //save the date of a gig
        return (
            isInArray(item.city, cities) && //is the city in the city array?
            (date.isBetween(startDate, endDate)) //is the date of gig inbetween the start and end date?
        );
    });
    console.log(filtered); //new filtered array

    events.set(filtered);
}

var search = (function() {

})();

var events = (function() {
    var eventsArray = []; //self contained array, events.set(filtered) passes our filtered array in

    // cache DOM
    var $el = $('#output'); //the area where the info is gonna be displayed
    var $insert = $el.find('#insert-events'); //
    var template = Handlebars.compile($el.find('#events-template').html()); //the template the html adheres to

    // bind events
    function render() {
        $insert.html(template(eventsArray)); //inserts into template, in {{#each this}} it is THIS
    }

    function setEvents(data) {
        eventsArray = data; //events array become the filtered array
        render();
    }

    return {
        set: setEvents //filtered into setEvents^
    };
})();

// $.getJSON("./gigs.json", function(data) {});

// $.ajax({
//     type: 'GET',
//     dataType: "jsonp",
//     url: "gigs.json",
//     success: function(response) {

//         console.log(response);
//     }
// });

// var arr = [{
//     city: 'York'
// }, {
//     city: 'Manchester'
// }];


// console.log(filtered);
